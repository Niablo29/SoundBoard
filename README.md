# SoundBoard

A standalone C library and example CLI for WAV audio manipulation: loading, saving, clipping, insertion of segments, and advertisement detection via cross-correlation. No external spec is needed—this README covers everything to get started.

---

## Table of Contents

1. [Features](#features)
2. [Prerequisites](#prerequisites)
3. [Building](#building)
4. [Running the Example](#running-the-example)
5. [Library API](#library-api)
6. [Integrating into Your Code](#integrating-into-your-code)
7. [Repository Structure](#repository-structure)
8. [Ignored Files](#ignored-files)
9. [License](#license)

---

## Features

* **Load & Save WAV**: Read `.wav` files and write them back to disk.
* **Clip Segments**: Remove or extract ranges by sample index.
* **Insert Segments**: Copy or share data between tracks without full duplication.
* **Detect Advertisements**: Find occurrences of a known audio ‘pattern’ via cross-correlation.
* **Flatten Hierarchies**: Combine parent–child track relationships into one continuous track.

---

## Prerequisites

* GCC or Clang
* GNU Make
* Unix-like shell (Linux, WSL, macOS)

---

## Building

From the project root:

```bash
make all
```

* Produces `sound_seg.o` (position-independent, ASAN-friendly).
* Optionally builds any test binaries under `tests/` if present.

To clean up:

```bash
make clean
```

---

## Running the Example

An example client (`example/main.c`) demonstrates basic usage. To build and run:

```bash
cd example
make all         # builds `example` binary linking sound_seg.o
```

Prepare your sample files in `example/`:

* `input.wav` – the main audio file
* `ad_clip.wav` – the snippet to detect and manipulate

Then run:

```bash
./example
```

The program will:

1. Load `input.wav` and `ad_clip.wav`.
2. Detect ad positions and print their sample indices.
3. Delete the first ad and reinsert it at the end.
4. Write `output.wav` with the modified track.

You’ll find `output.wav` in the `example/` folder.

---

## Library API

Include `sound_seg.h` and link against `sound_seg.o`.

```c
// Handle for a loaded WAV track
typedef struct Track Track;

// Load a WAV file (returns NULL on error)
Track *load_wav(const char *filename);

// Save a WAV file (returns 0 on success)
int save_wav(const Track *track, const char *filename);

// Remove samples in [start, end)
void delete_segment(Track *track, size_t start, size_t end);

// Insert from src into dst at pos; if share!=0, no data copy
void insert_segment(Track *dst, const Track *src, size_t pos, int share);

// Detect `pattern` (int16_t samples, length pattern_len)
// Returns malloc'd array of indices; out_count set to length
size_t *detect_ads(const Track *track,
                   const int16_t *pattern,
                   size_t pattern_len,
                   size_t *out_count);

// Free a Track
void free_track(Track *track);
```

Compile your code with:

```bash
gcc -o myapp myapp.c ../sound_seg.o
```

---

## Integrating into Your Code

1. Copy `sound_seg.h` and `sound_seg.c` (or link `sound_seg.o`) into your project.
2. Include `sound_seg.h` in your source files.
3. Link against `sound_seg.o` when compiling.

You can also wrap the API in your own CLI parser to support commands like:

```bash
soundboard clip input.wav output.wav --start 10000 --end 50000
soundboard detect input.wav ad_clip.wav
soundboard insert input.wav ad_clip.wav output.wav --pos 120000 --share
```

---

## Repository Structure

```
SoundBoard/
├── makefile                  # top-level build rules
├── sound_seg.c               # core implementation
├── sound_seg.h               # API definitions
├── sound_seg.o               # build artifact (ignored)
├── example/
│   ├── main.c                # sample client code
│   ├── Makefile              # builds `example`
│   ├── input.wav             # example input (user-provided)
│   ├── ad_clip.wav           # example ad pattern (user-provided)
│   └── output.wav            # generated by `./example`
├── tests/                    # (optional) unit/integration tests
├── .gitignore
└── README.md                 # this file
```

---

## Ignored Files

```
*.o
.vscode/
```
